---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.17.3
  name: workloadsessionpolicies.tmc.kcp.io
spec:
  group: tmc.kcp.io
  names:
    kind: WorkloadSessionPolicy
    listKind: WorkloadSessionPolicyList
    plural: workloadsessionpolicies
    singular: workloadsessionpolicy
  scope: Namespaced
  versions:
  - name: v1alpha1
    schema:
      openAPIV3Schema:
        properties:
          apiVersion:
            type: string
          kind:
            type: string
          metadata:
            type: object
          spec:
            properties:
              clusterSelector:
                properties:
                  clusterNames:
                    items:
                      type: string
                    type: array
                  labelSelector:
                    properties:
                      matchExpressions:
                        items:
                          properties:
                            key:
                              type: string
                            operator:
                              type: string
                            values:
                              items:
                                type: string
                              type: array
                              x-kubernetes-list-type: atomic
                          required:
                          - key
                          - operator
                          type: object
                        type: array
                        x-kubernetes-list-type: atomic
                      matchLabels:
                        additionalProperties:
                          type: string
                        type: object
                    type: object
                    x-kubernetes-map-type: atomic
                  locationSelector:
                    items:
                      type: string
                    type: array
                type: object
              sessionAffinity:
                properties:
                  cookieName:
                    type: string
                  headerName:
                    type: string
                  timeoutSeconds:
                    default: 3600
                    format: int32
                    type: integer
                  type:
                    allOf:
                    - enum:
                      - ClientIP
                      - Cookie
                      - Header
                      - None
                    - enum:
                      - ClientIP
                      - Cookie
                      - Header
                      - None
                    default: ClientIP
                    type: string
                type: object
              sessionConfig:
                properties:
                  cookieConfig:
                    properties:
                      domain:
                        type: string
                      httpOnly:
                        default: true
                        type: boolean
                      maxAge:
                        default: 3600
                        format: int32
                        type: integer
                      name:
                        default: TMCSESSIONID
                        type: string
                      path:
                        default: /
                        type: string
                      sameSite:
                        allOf:
                        - enum:
                          - Strict
                          - Lax
                          - None
                        - enum:
                          - Strict
                          - Lax
                          - None
                        default: Lax
                        type: string
                      secure:
                        default: true
                        type: boolean
                    type: object
                  drainTimeout:
                    default: 300s
                    type: string
                  persistenceConfig:
                    properties:
                      backendType:
                        allOf:
                        - enum:
                          - Memory
                          - Redis
                        - enum:
                          - Memory
                          - Redis
                        default: Memory
                        type: string
                      connectionString:
                        type: string
                      enabled:
                        default: true
                        type: boolean
                      ttl:
                        default: 1800s
                        type: string
                    type: object
                  sessionType:
                    allOf:
                    - enum:
                      - Sticky
                      - RoundRobin
                      - LeastConnections
                      - IPHash
                      - Cookie
                    - enum:
                      - Sticky
                      - RoundRobin
                      - LeastConnections
                      - IPHash
                      - Cookie
                    type: string
                required:
                - sessionType
                type: object
              sessionTimeout:
                properties:
                  cleanupInterval:
                    default: 900s
                    type: string
                  idleTimeout:
                    default: 1800s
                    type: string
                  maxLifetime:
                    default: 86400s
                    type: string
                  warningThreshold:
                    default: 300s
                    type: string
                type: object
              workloadSelector:
                properties:
                  labelSelector:
                    properties:
                      matchExpressions:
                        items:
                          properties:
                            key:
                              type: string
                            operator:
                              type: string
                            values:
                              items:
                                type: string
                              type: array
                              x-kubernetes-list-type: atomic
                          required:
                          - key
                          - operator
                          type: object
                        type: array
                        x-kubernetes-list-type: atomic
                      matchLabels:
                        additionalProperties:
                          type: string
                        type: object
                    type: object
                    x-kubernetes-map-type: atomic
                  namespaceSelector:
                    properties:
                      matchExpressions:
                        items:
                          properties:
                            key:
                              type: string
                            operator:
                              type: string
                            values:
                              items:
                                type: string
                              type: array
                              x-kubernetes-list-type: atomic
                          required:
                          - key
                          - operator
                          type: object
                        type: array
                        x-kubernetes-list-type: atomic
                      matchLabels:
                        additionalProperties:
                          type: string
                        type: object
                    type: object
                    x-kubernetes-map-type: atomic
                  workloadTypes:
                    items:
                      properties:
                        apiVersion:
                          type: string
                        kind:
                          type: string
                      required:
                      - apiVersion
                      - kind
                      type: object
                    type: array
                type: object
            required:
            - clusterSelector
            - sessionConfig
            - workloadSelector
            type: object
          status:
            properties:
              activeSessions:
                format: int32
                type: integer
              affectedWorkloads:
                items:
                  properties:
                    apiVersion:
                      type: string
                    kind:
                      type: string
                    name:
                      type: string
                    namespace:
                      type: string
                  required:
                  - apiVersion
                  - kind
                  - name
                  type: object
                type: array
              conditions:
                items:
                  properties:
                    lastTransitionTime:
                      format: date-time
                      type: string
                    message:
                      type: string
                    reason:
                      type: string
                    severity:
                      type: string
                    status:
                      type: string
                    type:
                      type: string
                  required:
                  - lastTransitionTime
                  - status
                  - type
                  type: object
                type: array
              lastUpdateTime:
                format: date-time
                type: string
              message:
                type: string
              phase:
                default: Active
                enum:
                - Active
                - Draining
                - Suspended
                - Failed
                - Unknown
                type: string
              sessionBackends:
                items:
                  properties:
                    activeSessions:
                      format: int32
                      type: integer
                    clusterName:
                      type: string
                    healthCheckFailures:
                      format: int32
                      type: integer
                    lastHealthCheck:
                      format: date-time
                      type: string
                    message:
                      type: string
                    name:
                      type: string
                    status:
                      allOf:
                      - enum:
                        - Healthy
                        - Unhealthy
                        - Draining
                        - Unknown
                      - enum:
                        - Healthy
                        - Unhealthy
                        - Draining
                        - Unknown
                      type: string
                    weight:
                      format: int32
                      type: integer
                  required:
                  - activeSessions
                  - clusterName
                  - healthCheckFailures
                  - name
                  - status
                  - weight
                  type: object
                type: array
              totalSessions:
                format: int32
                type: integer
            required:
            - activeSessions
            - totalSessions
            type: object
        type: object
    served: true
    storage: true
    subresources:
      status: {}
